<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portable OCR File Renamer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }
        
        .main-container {
            height: 100vh;
            display: grid;
            grid-template-rows: auto 1fr auto;
            gap: 0.5rem;
            padding: 0.75rem;
        }
        
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 0.75rem;
            overflow: hidden;
        }
        
        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            overflow-y: auto;
        }
        
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            overflow: hidden;
        }
        
        .component-box {
            cursor: grab;
            transition: all 0.2s ease;
        }
        .component-box:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(79, 70, 229, 0.2);
        }
        .component-box:active {
            cursor: grabbing;
        }
        
        .drop-zone {
            min-height: 60px;
            transition: all 0.3s;
        }
        .drop-zone.drag-over {
            background-color: #EEF2FF;
            border-color: #4F46E5;
        }
        
        .selected-component {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: grab;
            transition: all 0.2s ease;
        }
        .selected-component:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .results-area {
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }
        
        .start-button {
            background: linear-gradient(to right, #4F46E5 0%, #7C3AED 51%, #4F46E5 100%);
            background-size: 200% auto;
            transition: 0.3s;
        }
        .start-button:hover:not(:disabled) {
            background-position: right center;
        }
        
        .card {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .compact-input {
            padding: 0.375rem 0.5rem;
            font-size: 0.75rem;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Header -->
        <header class="card p-3 text-center">
            <h1 class="text-xl font-bold text-gray-800">Batch OCR Renamer</h1>
            <p class="text-xs text-gray-500 mt-1">Build filename ‚Ä¢ Drop files ‚Ä¢ Process</p>
        </header>

        <!-- Main Content Grid -->
        <div class="content-grid">
            <!-- LEFT PANEL: Configuration & Components -->
            <div class="left-panel">
                <!-- Settings Card -->
                <div class="card p-3">
                    <h3 class="text-sm font-bold text-gray-800 mb-2">‚öôÔ∏è Settings</h3>
                    <div class="space-y-2">
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Prefix</label>
                            <input type="text" id="customPrefix" placeholder="Optional" 
                                   class="compact-input w-full rounded border-gray-300 border focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Separator</label>
                                <select id="separator" class="compact-input w-full rounded border-gray-300 border bg-white focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
                                    <option value="">NONE</option>
                                    <option value="_">_ (underscore)</option>
                                    <option value="-">- (hyphen)</option>
                                    <option value=".">. (dot)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Scan Area</label>
                                <div id="scanAreaInfo" class="compact-input bg-green-50 border border-green-300 rounded text-green-700 font-medium">
                                    Top 50%
                                </div>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Preview</label>
                            <div id="filenamePreview" class="compact-input bg-gray-50 border border-gray-300 rounded text-gray-600 font-mono text-xs">
                                <span class="text-gray-400 italic">Add components...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filename Builder Card -->
                <div class="card p-3 flex-1 flex flex-col min-h-0">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-bold text-gray-800">üéØ Filename Builder</h3>
                        <button id="clearAllBtn" onclick="clearAllComponents()" 
                                class="hidden px-2 py-1 text-xs font-semibold text-red-600 bg-red-50 border border-red-300 rounded hover:bg-red-100">
                            Clear
                        </button>
                    </div>
                    
                    <div id="filenameBuilder" class="drop-zone bg-gray-50 rounded border-2 border-dashed border-gray-300 p-2 mb-3 flex flex-wrap gap-1 items-start content-start">
                        <p class="text-center text-gray-400 text-xs w-full" id="builderPlaceholder">Drag components here</p>
                    </div>
                    
                    <div class="flex-1 overflow-y-auto min-h-0">
                        <label class="block text-xs font-medium text-gray-700 mb-2">Available Components</label>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="component-box p-2 bg-white rounded border-2 border-gray-300 hover:border-indigo-400" 
                                 draggable="true" data-component="vendor" data-label="Vendor" data-color="bg-blue-100 text-blue-800">
                                <div class="text-xs font-semibold text-gray-700">üìã Vendor</div>
                                <p class="text-xs text-gray-500">First line</p>
                            </div>

                            <div class="component-box p-2 bg-white rounded border-2 border-gray-300 hover:border-indigo-400" 
                                 draggable="true" data-component="date" data-label="Date" data-color="bg-green-100 text-green-800">
                                <div class="text-xs font-semibold text-gray-700">üìÖ Date</div>
                                <p class="text-xs text-gray-500">YYYYMMDD</p>
                            </div>

                            <div class="component-box p-2 bg-white rounded border-2 border-gray-300 hover:border-indigo-400" 
                                 draggable="true" data-component="invoice_number" data-label="Invoice" data-color="bg-yellow-100 text-yellow-800">
                                <div class="text-xs font-semibold text-gray-700">üßæ Invoice</div>
                                <p class="text-xs text-gray-500">Invoice ID</p>
                            </div>

                            <div class="component-box p-2 bg-white rounded border-2 border-gray-300 hover:border-indigo-400" 
                                 draggable="true" data-component="reference_number" data-label="Reference" data-color="bg-purple-100 text-purple-800">
                                <div class="text-xs font-semibold text-gray-700">üîñ Reference</div>
                                <p class="text-xs text-gray-500">Ref/PO</p>
                            </div>

                            <div class="component-box p-2 bg-white rounded border-2 border-gray-300 hover:border-indigo-400" 
                                 draggable="true" data-component="amount" data-label="Amount" data-color="bg-red-100 text-red-800">
                                <div class="text-xs font-semibold text-gray-700">üí∞ Amount</div>
                                <p class="text-xs text-gray-500">Total USD</p>
                            </div>

                            <div class="component-box p-2 bg-white rounded border-2 border-gray-300 hover:border-indigo-400" 
                                 draggable="true" data-component="timestamp" data-label="Time" data-color="bg-gray-100 text-gray-800">
                                <div class="text-xs font-semibold text-gray-700">‚è∞ Time</div>
                                <p class="text-xs text-gray-500">HHMMSS</p>
                            </div>

                            <div class="component-box p-2 bg-white rounded border-2 border-emerald-300 hover:border-emerald-500" 
                                 draggable="true" data-component="original_filename" data-label="Original" data-color="bg-emerald-100 text-emerald-800">
                                <div class="text-xs font-semibold text-gray-700">üìÑ Original</div>
                                <p class="text-xs text-gray-500">Keep name</p>
                            </div>

                            <div class="component-box p-2 bg-white rounded border-2 border-indigo-300 hover:border-indigo-500" 
                                 draggable="true" data-component="custom_match" data-label="Regex" data-color="bg-indigo-100 text-indigo-800"
                                 data-requires-input="regexPrefixTerm">
                                <div class="text-xs font-semibold text-gray-700">üîç Regex</div>
                                <input type="text" id="regexPrefixTerm" placeholder="PO- or 782" 
                                       class="mt-1 w-full rounded border-gray-300 p-1 text-xs border"
                                       onclick="event.stopPropagation()">
                            </div>

                            <div class="component-box p-2 bg-white rounded border-2 border-purple-300 hover:border-purple-500" 
                                 draggable="true" data-component="targeted_label" data-label="Field" data-color="bg-purple-100 text-purple-800"
                                 data-requires-input="targetedLabelTerm">
                                <div class="text-xs font-semibold text-gray-700">üéØ Field</div>
                                <input type="text" id="targetedLabelTerm" placeholder="NAME: or ID:" 
                                       class="mt-1 w-full rounded border-gray-300 p-1 text-xs border"
                                       onclick="event.stopPropagation()">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RIGHT PANEL: Upload & Results -->
            <div class="right-panel">
                <!-- Upload Area Card -->
                <div class="card p-4 text-center cursor-pointer hover:shadow-lg transition-shadow"
                     onclick="document.getElementById('fileInput').click()">
                    <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 014 4v2a4 4 0 01-4 4h-4a4 4 0 01-4-4v-4m-2 4h4m-4 0v-4" />
                    </svg>
                    <p class="mt-2 text-sm text-gray-600 font-medium">Drop files or click</p>
                    <p class="text-xs text-gray-400">.JPG, .PNG, .PDF</p>
                    <input type="file" id="fileInput" accept="image/jpeg, image/png, application/pdf" multiple class="hidden" onchange="handleFiles(this.files)">
                </div>

                <!-- Control Card -->
                <div class="card p-3">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <span class="text-sm font-semibold text-gray-700">Files:</span>
                            <span id="fileCount" class="text-xl font-bold text-indigo-600">0</span>
                        </div>
                        <button id="startButton" onclick="startBatchProcessing()" disabled
                                class="start-button py-2 px-6 text-sm font-semibold text-white rounded-lg shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                            Start Processing
                        </button>
                    </div>
                    
                    <div id="statusArea" class="hidden mt-3">
                        <div class="w-full bg-gray-200 rounded-full h-2 mb-1">
                            <div id="progressBar" class="bg-indigo-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                        <p id="statusMessage" class="text-xs text-indigo-600 font-medium text-center">Ready...</p>
                    </div>
                </div>

                <!-- Results Area Card -->
                <div class="card p-3 flex-1 flex flex-col min-h-0">
                    <h3 class="text-sm font-bold text-gray-800 mb-2">üìã Queue / Results</h3>
                    <div id="resultsContainer" class="results-area space-y-2"></div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="card p-2 text-center">
            <p class="text-xs text-gray-400">
                Made by <a href="https://github.com/ertwrx" target="_blank" class="text-indigo-500 hover:text-indigo-700">@ertwrx</a>
            </p>
        </footer>
    </div>

    <!-- Toast -->
    <div id="copyToast" class="fixed bottom-5 right-5 bg-indigo-600 text-white px-4 py-2 rounded-lg shadow-xl opacity-0 transition-opacity duration-300">
        Download started!
    </div>

    <script>
        const API_URL = 'http://127.0.0.1:5000/ocr-rename'; 
        const resultsContainer = document.getElementById('resultsContainer');
        const statusArea = document.getElementById('statusArea');
        const progressBar = document.getElementById('progressBar');
        const statusMessage = document.getElementById('statusMessage');
        const copyToast = document.getElementById('copyToast');
        const fileCountSpan = document.getElementById('fileCount');
        const startButton = document.getElementById('startButton');
        const filenameBuilder = document.getElementById('filenameBuilder');
        const builderPlaceholder = document.getElementById('builderPlaceholder');
        const filenamePreview = document.getElementById('filenamePreview');
        const scanAreaInfo = document.getElementById('scanAreaInfo');
        
        let fileQueue = [];
        let selectedComponents = [];
        let draggedElement = null;

        const componentScanDepth = {
            'vendor': 30, 'date': 40, 'invoice_number': 50, 'reference_number': 50,
            'custom_match': 50, 'targeted_label': 50, 'amount': 100,
            'timestamp': 0, 'original_filename': 0
        };

        document.querySelectorAll('.component-box').forEach(box => {
            box.addEventListener('dragstart', handleDragStart);
            box.addEventListener('dragend', handleDragEnd);
        });

        filenameBuilder.addEventListener('dragover', handleDragOver);
        filenameBuilder.addEventListener('drop', handleDropComponent);
        filenameBuilder.addEventListener('dragleave', handleDragLeave);

        function handleDragStart(e) {
            draggedElement = e.currentTarget;
            e.currentTarget.classList.add('opacity-50');
            e.dataTransfer.effectAllowed = 'copy';
        }

        function handleDragEnd(e) {
            e.currentTarget.classList.remove('opacity-50');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'copy';
            filenameBuilder.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            if (e.target === filenameBuilder) {
                filenameBuilder.classList.remove('drag-over');
            }
        }

        function handleDropComponent(e) {
            e.preventDefault();
            filenameBuilder.classList.remove('drag-over');
            
            if (!draggedElement) return;

            const componentType = draggedElement.getAttribute('data-component');
            const componentLabel = draggedElement.getAttribute('data-label');
            const componentColor = draggedElement.getAttribute('data-color');
            const requiresInput = draggedElement.getAttribute('data-requires-input');

            if (selectedComponents.find(c => c.type === componentType)) {
                showToast('Already added!', 'bg-yellow-500');
                return;
            }

            if (requiresInput) {
                const inputValue = document.getElementById(requiresInput).value.trim();
                if (!inputValue) {
                    showToast('Enter search term first!', 'bg-red-500');
                    return;
                }
            }

            selectedComponents.push({
                type: componentType,
                label: componentLabel,
                color: componentColor,
                requiresInput: requiresInput
            });

            renderFilenameBuilder();
            updateFilenamePreview();
        }

        function renderFilenameBuilder() {
            const clearAllBtn = document.getElementById('clearAllBtn');
            
            if (selectedComponents.length === 0) {
                filenameBuilder.innerHTML = '<p class="text-center text-gray-400 text-xs w-full" id="builderPlaceholder">Drag components here</p>';
                clearAllBtn.classList.add('hidden');
                return;
            }

            clearAllBtn.classList.remove('hidden');
            filenameBuilder.innerHTML = '';

            selectedComponents.forEach((comp, index) => {
                const compElement = document.createElement('div');
                compElement.className = `selected-component inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-semibold ${comp.color}`;
                compElement.innerHTML = `
                    <span>${comp.label}</span>
                    <button class="ml-1 hover:bg-white hover:bg-opacity-20 rounded-full w-4 h-4 flex items-center justify-center text-xs" onclick="removeComponent(${index})">√ó</button>
                `;
                filenameBuilder.appendChild(compElement);
            });
        }

        function removeComponent(index) {
            selectedComponents.splice(index, 1);
            renderFilenameBuilder();
            updateFilenamePreview();
        }

        function clearAllComponents() {
            if (selectedComponents.length === 0) return;
            selectedComponents = [];
            renderFilenameBuilder();
            updateFilenamePreview();
            showToast('Cleared!', 'bg-gray-600');
        }

        function updateFilenamePreview() {
            const separator = document.getElementById('separator').value;
            const prefix = document.getElementById('customPrefix').value.trim();
            
            if (selectedComponents.length === 0) {
                filenamePreview.innerHTML = '<span class="text-gray-400 italic">Add components...</span>';
                updateScanAreaInfo();
                return;
            }

            let previewParts = [];
            if (prefix) previewParts.push(prefix);
            selectedComponents.forEach(comp => previewParts.push(`[${comp.label}]`));

            filenamePreview.textContent = previewParts.join(separator || '') + '.pdf';
            updateScanAreaInfo();
        }

        function updateScanAreaInfo() {
            if (selectedComponents.length === 0) {
                scanAreaInfo.textContent = 'Top 50%';
                scanAreaInfo.className = 'compact-input bg-green-50 border border-green-300 rounded text-green-700 font-medium';
                return;
            }
            
            const hasAmount = selectedComponents.some(comp => comp.type === 'amount');
            
            if (hasAmount) {
                scanAreaInfo.textContent = 'Full 100%';
                scanAreaInfo.className = 'compact-input bg-orange-50 border border-orange-300 rounded text-orange-700 font-medium';
                return;
            }
            
            let maxDepth = 30;
            selectedComponents.forEach(comp => {
                const depth = componentScanDepth[comp.type] || 30;
                if (comp.type !== 'timestamp' && comp.type !== 'original_filename') {
                    if (depth > maxDepth) maxDepth = depth;
                }
            });
            
            const adaptiveCrop = Math.min(maxDepth + 10, 100);
            scanAreaInfo.textContent = `Top ${adaptiveCrop}%`;
            scanAreaInfo.className = 'compact-input bg-green-50 border border-green-300 rounded text-green-700 font-medium';
        }

        document.getElementById('customPrefix').addEventListener('input', updateFilenamePreview);
        document.getElementById('separator').addEventListener('change', updateFilenamePreview);

        function getComponentSelection() {
            return selectedComponents.map(c => c.type);
        }

        function showToast(message, colorClass = 'bg-indigo-600') {
            copyToast.textContent = message;
            copyToast.className = `fixed bottom-5 right-5 text-white px-4 py-2 rounded-lg shadow-xl transition-opacity duration-300 ${colorClass}`;
            copyToast.classList.add('opacity-100');
            setTimeout(() => {
                copyToast.classList.remove('opacity-100');
                copyToast.classList.add('opacity-0');
            }, 2500);
        }

        function triggerDownload(fileBlob, newFileName) {
            const url = URL.createObjectURL(fileBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = newFileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showToast(`Downloaded: ${newFileName}`);
        }

        function renderQueueItem(file, status = 'Pending', newName = 'N/A') {
            const itemId = `item-${file.name.replace(/[^a-zA-Z0-9]/g, '-')}-${file.size}`;
            let item = document.getElementById(itemId);

            if (!item) {
                item = document.createElement('div');
                item.id = itemId;
                item.className = 'flex items-center justify-between p-2 bg-gray-50 rounded shadow-sm';
                item.innerHTML = `
                    <div class="flex-1 min-w-0">
                        <p class="text-xs font-medium truncate">${file.name}</p>
                        <p class="text-xs text-gray-500 truncate" data-field="newName">${newName}</p>
                    </div>
                    <span class="px-2 text-xs font-semibold rounded-full ml-2 flex-shrink-0" data-field="status">${status}</span>
                `;
                resultsContainer.appendChild(item);
            } else {
                const statusSpan = item.querySelector('[data-field="status"]');
                const newNameP = item.querySelector('[data-field="newName"]');
                
                statusSpan.textContent = status;
                newNameP.textContent = newName;

                if (status === 'Pending') {
                    statusSpan.className = 'px-2 text-xs font-semibold rounded-full ml-2 flex-shrink-0 bg-yellow-100 text-yellow-800';
                } else if (status.startsWith('Processing')) {
                    statusSpan.className = 'px-2 text-xs font-semibold rounded-full ml-2 flex-shrink-0 bg-blue-100 text-blue-800';
                } else if (status === 'COMPLETE') {
                    statusSpan.className = 'px-2 text-xs font-semibold rounded-full ml-2 flex-shrink-0 bg-green-100 text-green-800';
                } else if (status.startsWith('ERROR')) {
                    statusSpan.className = 'px-2 text-xs font-semibold rounded-full ml-2 flex-shrink-0 bg-red-100 text-red-800';
                }
            }
        }

        async function processFileOnServer(file) {
            const customPrefix = document.getElementById('customPrefix').value.trim();
            const separator = document.getElementById('separator').value.trim();
            const componentList = getComponentSelection().join(','); 
            const regexPrefixTerm = document.getElementById('regexPrefixTerm').value.trim(); 
            const targetedLabelTerm = document.getElementById('targetedLabelTerm').value.trim(); 

            const formData = new FormData();
            formData.append('file', file);
            formData.append('custom_prefix', customPrefix);
            formData.append('separator', separator);
            formData.append('component_list', componentList);
            formData.append('custom_search_term', regexPrefixTerm); 
            formData.append('targeted_label_term', targetedLabelTerm); 

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData,
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP Error: ${response.status}`);
                }

                const data = await response.json();
                return {
                    suggested_name: data.suggested_name,
                    extracted_text: data.extracted_text
                };
            } catch (error) {
                console.error("Error:", error);
                return { 
                    suggested_name: 'FAILED', 
                    extracted_text: error.message.includes('Failed to fetch') ? 
                        'Connection failed. Check server.' : error.message,
                    error: true 
                };
            }
        }

        async function startBatchProcessing() {
            if (fileQueue.length === 0) {
                statusMessage.textContent = 'Queue empty!';
                return;
            }
            
            const onlyOriginalSelected = selectedComponents.length === 1 && 
                                         selectedComponents[0].type === 'original_filename';
            
            if (onlyOriginalSelected) {
                showToast('Add more components!', 'bg-red-500');
                return;
            }
            
            if (selectedComponents.length === 0) {
                showToast('Add components first!', 'bg-red-500');
                return; 
            }

            startButton.disabled = true;
            statusArea.classList.remove('hidden');

            for (let i = 0; i < fileQueue.length; i++) {
                const file = fileQueue[i];
                const currentFileIndex = i + 1;
                const totalFiles = fileQueue.length;

                statusMessage.textContent = `Processing ${currentFileIndex}/${totalFiles}`;
                renderQueueItem(file, `Processing...`, 'Scanning...');
                progressBar.style.width = `${(currentFileIndex - 1) * 100 / totalFiles + 10}%`;

                const result = await processFileOnServer(file);
                progressBar.style.width = `${currentFileIndex * 100 / totalFiles}%`;

                if (result.error) {
                    renderQueueItem(file, 'ERROR', result.extracted_text);
                    showToast(`Error: ${file.name}`, 'bg-red-500');
                } else {
                    renderQueueItem(file, 'COMPLETE', result.suggested_name);
                    triggerDownload(file, result.suggested_name);
                }
            }

            statusMessage.textContent = `Complete! Refreshing...`;
            setTimeout(() => location.reload(), 2000);
        }

        function handleFiles(files) {
            if (files.length === 0) return;
            
            startButton.disabled = false;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const isDuplicate = fileQueue.some(qf => qf.name === file.name && qf.size === file.size);
                
                if (!isDuplicate) {
                    fileQueue.push(file);
                    renderQueueItem(file);
                }
            }
            fileCountSpan.textContent = fileQueue.length;
        }

        const dropArea = document.querySelector('.card.cursor-pointer');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, (e) => {
                e.preventDefault();
                e.stopPropagation();
            }, false);
        });

        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, () => {
                dropArea.classList.add('ring-2', 'ring-indigo-500', 'bg-indigo-50');
            }, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, () => {
                dropArea.classList.remove('ring-2', 'ring-indigo-500', 'bg-indigo-50');
            }, false);
        });

        dropArea.addEventListener('drop', (e) => {
            let dt = e.dataTransfer;
            let files = dt.files;
            handleFiles(files);
        }, false);

        window.startBatchProcessing = startBatchProcessing;
        window.handleFiles = handleFiles;
        window.removeComponent = removeComponent;
        window.clearAllComponents = clearAllComponents;
    </script>
</body>
</html>
